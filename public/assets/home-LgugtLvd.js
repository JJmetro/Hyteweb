import"./style-Wm2d1EGB.js";let w=localStorage.getItem("name");document.getElementById("name").innerHTML=w;const v=document.querySelector(".get_users");v.addEventListener("click",E);async function E(){console.log("Button clicked!");try{const e=localStorage.getItem("token"),r=await(await fetch("http://127.0.0.1:3000/api/users",{headers:{Authorization:"Bearer: "+e}})).json();console.log(r);const a=document.querySelector(".tbody");a.innerHTML="",r.forEach(n=>{console.log(n.username);let o=document.createElement("tr"),i=document.createElement("td");i.innerText=n.username;let c=document.createElement("td");c.innerText=n.user_level;let d=document.createElement("td"),l=document.createElement("button");l.className="check",l.setAttribute("data-id","1"),l.innerText="Info",l.addEventListener("click",()=>I(n.user_id)),d.appendChild(l);let u=document.createElement("td"),s=document.createElement("button");s.className="del",s.setAttribute("data-id","1"),s.innerText="Delete",s.innerText="Delete",s.addEventListener("click",()=>k(n.user_id)),u.appendChild(s);let m=document.createElement("td");m.innerText=n.user_id,o.appendChild(i),o.appendChild(c),o.appendChild(d),o.appendChild(u),o.appendChild(m),a.appendChild(o)})}catch(e){console.log(e)}}async function I(e){try{const t=localStorage.getItem("token"),a=await(await fetch(`http://127.0.0.1:3000/api/users/${e}`,{method:"GET",headers:{Authorization:"Bearer: "+t}})).json();console.log(a),B(a)}catch(t){console.error("Error fetching user data:",t)}}function B(e){const t=document.querySelector(".info_dialog"),r=t.querySelectorAll("span");r[0].innerText=e.user_id,r[1].innerText=e.username,r[2].innerText=e.email,r[3].innerText=e.user_level,t.showModal(),t.querySelector("button[autofocus]").addEventListener("click",()=>{t.close()})}async function k(e){try{const t=localStorage.getItem("token");if(localStorage.getItem("user_level")!=="admin"){alert("Unauthorized: Only admins can delete users");return}if(!confirm(`Are you sure you want to delete the user with ID: ${e}?`))return;const n=await fetch(`http://127.0.0.1:3000/api/users/${e}`,{method:"DELETE",headers:{Authorization:"Bearer: "+t}});if(n.ok)alert("User deleted successfully");else{const o=await n.json();if(o.error&&o.error===409)alert("Cannot delete user: user has diary entries, need to be deleted first.");else throw new Error("Failed to delete user")}await E()}catch(t){alert("Error deleting user: "+t.message)}}async function T(e){try{const t=localStorage.getItem("token");if(!confirm(`Are you sure you want to delete the entry with ID: ${e}?`))return;if(!(await fetch(`http://127.0.0.1:3000/api/entries/${e}`,{method:"DELETE",headers:{Authorization:"Bearer: "+t}})).ok)throw new Error("Failed to delete entry");alert("entry deleted successfully"),await f()}catch(t){window.alert("Error deleting entry",t)}}const y=document.getElementById("addEntryButton");document.querySelector(".addform");y.addEventListener("click",async e=>{e.preventDefault(),console.log(y);const t=document.getElementById("entry_date").value,r=S(t),a=document.getElementById("mood").value,n=parseFloat(document.getElementById("weight").value),o=parseInt(document.getElementById("sleep_hours").value),i=document.getElementById("notes").value,c={entry_date:r,mood:a,weight:n,sleep_hours:o,notes:i};console.log(c);try{const d=localStorage.getItem("token");if(!(await fetch("http://127.0.0.1:3000/api/entries",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+d},body:JSON.stringify(c)})).ok)throw new Error("Failed to add entry");alert("Entry added successfully"),document.getElementById("entry_date").value="",document.getElementById("mood").value="",document.getElementById("weight").value="",document.getElementById("sleep_hours").value="",document.getElementById("notes").value=""}catch(d){console.error("Error adding entry:",d),alert("Error adding entry: "+d.message)}});function S(e){const t=new Date(e),r=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0");return`${r}-${a}-${n}`}const C=document.getElementById("putUserButton");C.addEventListener("click",async()=>{const e=localStorage.getItem("token"),t=document.getElementById("username").value,r=document.getElementById("password").value,a=document.getElementById("email").value,n={username:t,password:r,email:a};try{if(!(await fetch("http://localhost:3000/api/users/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify(n)})).ok)throw new Error("Failed to update user");window.alert("User updated successfully"),document.getElementById("username").value="",document.getElementById("password").value="",document.getElementById("email").value=""}catch{window.alert("Error updating user: Inserted account information is not valid or dont meet the requirements. ")}});const _=document.querySelector(".get_entry");_.addEventListener("click",f);async function f(){console.log("Button clicked!");try{const e=localStorage.getItem("token"),r=await(await fetch("http://127.0.0.1:3000/api/entries",{headers:{Authorization:"Bearer: "+e}})).json();if(console.log(r),r.length===0){alert("No diary entries found!");return}const a=document.querySelector(".tbody1");a.innerHTML="",r.forEach(n=>{let o=document.createElement("tr"),i=document.createElement("td");i.innerText=n.entry_id;let c=document.createElement("td");c.innerText=n.username;let d=document.createElement("td");d.innerText=n.entry_date;let l=document.createElement("td");l.innerText=n.mood;let u=document.createElement("td");u.innerText=parseFloat(n.weight).toFixed(2);let s=document.createElement("td");s.innerText=parseInt(n.sleep_hours);let m=document.createElement("td");m.innerText=n.notes;let h=document.createElement("td");h.innerText=n.created_at;let g=document.createElement("td"),p=document.createElement("button");p.className="del",p.setAttribute("data-id",n.entry_id),p.innerText="Delete",p.addEventListener("click",()=>T(n.entry_id)),g.appendChild(p),o.appendChild(i),o.appendChild(c),o.appendChild(d),o.appendChild(l),o.appendChild(u),o.appendChild(s),o.appendChild(m),o.appendChild(h),o.appendChild(g),a.appendChild(o)})}catch(e){console.log(e)}}const b=document.querySelector(".activate_logout");b.addEventListener("click",x);function x(e){e.preventDefault(),localStorage.removeItem("token"),localStorage.removeItem("name"),localStorage.removeItem("user_level"),alert("You have been logged out successfully!"),window.location.href="start-auth.html"}
